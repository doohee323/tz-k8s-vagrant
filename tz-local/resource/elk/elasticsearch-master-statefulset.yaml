{
    "apiVersion": "apps/v1",
    "kind": "StatefulSet",
    "metadata": {
        "annotations": {
            "esMajorVersion": "7",
            "meta.helm.sh/release-name": "elasticsearch",
            "meta.helm.sh/release-namespace": "default"
        },
        "creationTimestamp": "2020-12-21T19:50:07Z",
        "generation": 1,
        "labels": {
            "app": "elasticsearch-master",
            "app.kubernetes.io/managed-by": "Helm",
            "chart": "elasticsearch",
            "heritage": "Helm",
            "release": "elasticsearch"
        },
        "managedFields": [
            {
                "apiVersion": "apps/v1",
                "fieldsType": "FieldsV1",
                "fieldsV1": {
                    "f:metadata": {
                        "f:annotations": {
                            ".": {},
                            "f:esMajorVersion": {},
                            "f:meta.helm.sh/release-name": {},
                            "f:meta.helm.sh/release-namespace": {}
                        },
                        "f:labels": {
                            ".": {},
                            "f:app": {},
                            "f:app.kubernetes.io/managed-by": {},
                            "f:chart": {},
                            "f:heritage": {},
                            "f:release": {}
                        }
                    },
                    "f:spec": {
                        "f:podManagementPolicy": {},
                        "f:replicas": {},
                        "f:revisionHistoryLimit": {},
                        "f:selector": {},
                        "f:serviceName": {},
                        "f:template": {
                            "f:metadata": {
                                "f:labels": {
                                    ".": {},
                                    "f:app": {},
                                    "f:chart": {},
                                    "f:heritage": {},
                                    "f:release": {}
                                },
                                "f:name": {}
                            },
                            "f:spec": {
                                "f:affinity": {
                                    ".": {},
                                    "f:podAntiAffinity": {
                                        ".": {},
                                        "f:requiredDuringSchedulingIgnoredDuringExecution": {}
                                    }
                                },
                                "f:containers": {
                                    "k:{\"name\":\"elasticsearch\"}": {
                                        ".": {},
                                        "f:env": {
                                            ".": {},
                                            "k:{\"name\":\"ES_JAVA_OPTS\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"cluster.initial_master_nodes\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"cluster.name\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"discovery.seed_hosts\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"network.host\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"node.data\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"node.ingest\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"node.master\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:value": {}
                                            },
                                            "k:{\"name\":\"node.name\"}": {
                                                ".": {},
                                                "f:name": {},
                                                "f:valueFrom": {
                                                    ".": {},
                                                    "f:fieldRef": {
                                                        ".": {},
                                                        "f:apiVersion": {},
                                                        "f:fieldPath": {}
                                                    }
                                                }
                                            }
                                        },
                                        "f:image": {},
                                        "f:imagePullPolicy": {},
                                        "f:name": {},
                                        "f:ports": {
                                            ".": {},
                                            "k:{\"containerPort\":9200,\"protocol\":\"TCP\"}": {
                                                ".": {},
                                                "f:containerPort": {},
                                                "f:name": {},
                                                "f:protocol": {}
                                            },
                                            "k:{\"containerPort\":9300,\"protocol\":\"TCP\"}": {
                                                ".": {},
                                                "f:containerPort": {},
                                                "f:name": {},
                                                "f:protocol": {}
                                            }
                                        },
                                        "f:readinessProbe": {
                                            ".": {},
                                            "f:exec": {
                                                ".": {},
                                                "f:command": {}
                                            },
                                            "f:failureThreshold": {},
                                            "f:initialDelaySeconds": {},
                                            "f:periodSeconds": {},
                                            "f:successThreshold": {},
                                            "f:timeoutSeconds": {}
                                        },
                                        "f:resources": {
                                            ".": {},
                                            "f:limits": {
                                                ".": {},
                                                "f:cpu": {},
                                                "f:memory": {}
                                            },
                                            "f:requests": {
                                                ".": {},
                                                "f:cpu": {},
                                                "f:memory": {}
                                            }
                                        },
                                        "f:securityContext": {
                                            ".": {},
                                            "f:capabilities": {
                                                ".": {},
                                                "f:drop": {}
                                            },
                                            "f:runAsNonRoot": {},
                                            "f:runAsUser": {}
                                        },
                                        "f:terminationMessagePath": {},
                                        "f:terminationMessagePolicy": {},
                                        "f:volumeMounts": {
                                            ".": {},
                                            "k:{\"mountPath\":\"/usr/share/elasticsearch/data\"}": {
                                                ".": {},
                                                "f:mountPath": {},
                                                "f:name": {}
                                            }
                                        }
                                    }
                                },
                                "f:dnsPolicy": {},
                                "f:enableServiceLinks": {},
                                "f:initContainers": {
                                    ".": {},
                                    "k:{\"name\":\"configure-sysctl\"}": {
                                        ".": {},
                                        "f:command": {},
                                        "f:image": {},
                                        "f:imagePullPolicy": {},
                                        "f:name": {},
                                        "f:resources": {},
                                        "f:securityContext": {
                                            ".": {},
                                            "f:privileged": {},
                                            "f:runAsUser": {}
                                        },
                                        "f:terminationMessagePath": {},
                                        "f:terminationMessagePolicy": {}
                                    }
                                },
                                "f:restartPolicy": {},
                                "f:schedulerName": {},
                                "f:securityContext": {
                                    ".": {},
                                    "f:fsGroup": {},
                                    "f:runAsUser": {}
                                },
                                "f:terminationGracePeriodSeconds": {}
                            }
                        },
                        "f:updateStrategy": {
                            "f:type": {}
                        },
                        "f:volumeClaimTemplates": {}
                    }
                },
                "manager": "Go-http-client",
                "operation": "Update",
                "time": "2020-12-21T19:50:07Z"
            },
            {
                "apiVersion": "apps/v1",
                "fieldsType": "FieldsV1",
                "fieldsV1": {
                    "f:status": {
                        "f:collisionCount": {},
                        "f:currentReplicas": {},
                        "f:currentRevision": {},
                        "f:observedGeneration": {},
                        "f:replicas": {},
                        "f:updateRevision": {},
                        "f:updatedReplicas": {}
                    }
                },
                "manager": "kube-controller-manager",
                "operation": "Update",
                "time": "2020-12-21T19:50:07Z"
            }
        ],
        "name": "elasticsearch-master",
        "namespace": "default",
        "resourceVersion": "28371",
        "uid": "18ca9458-666b-4571-a329-b07b11eab204"
    },
    "spec": {
        "podManagementPolicy": "Parallel",
        "replicas": 2,
        "revisionHistoryLimit": 10,
        "selector": {
            "matchLabels": {
                "app": "elasticsearch-master"
            }
        },
        "serviceName": "elasticsearch-master-headless",
        "template": {
            "metadata": {
                "creationTimestamp": null,
                "labels": {
                    "app": "elasticsearch-master",
                    "chart": "elasticsearch",
                    "heritage": "Helm",
                    "release": "elasticsearch"
                },
                "name": "elasticsearch-master"
            },
            "spec": {
                "affinity": {
                    "podAntiAffinity": {
                        "requiredDuringSchedulingIgnoredDuringExecution": [
                            {
                                "labelSelector": {
                                    "matchExpressions": [
                                        {
                                            "key": "app",
                                            "operator": "In",
                                            "values": [
                                                "elasticsearch-master"
                                            ]
                                        }
                                    ]
                                },
                                "topologyKey": "kubernetes.io/hostname"
                            }
                        ]
                    }
                },
                "containers": [
                    {
                        "env": [
                            {
                                "name": "node.name",
                                "valueFrom": {
                                    "fieldRef": {
                                        "apiVersion": "v1",
                                        "fieldPath": "metadata.name"
                                    }
                                }
                            },
                            {
                                "name": "cluster.initial_master_nodes",
                                "value": "elasticsearch-master-0,elasticsearch-master-1,elasticsearch-master-2,"
                            },
                            {
                                "name": "discovery.seed_hosts",
                                "value": "elasticsearch-master-headless"
                            },
                            {
                                "name": "cluster.name",
                                "value": "elasticsearch"
                            },
                            {
                                "name": "network.host",
                                "value": "0.0.0.0"
                            },
                            {
                                "name": "ES_JAVA_OPTS",
                                "value": "-Xmx1g -Xms1g"
                            },
                            {
                                "name": "node.data",
                                "value": "true"
                            },
                            {
                                "name": "node.ingest",
                                "value": "true"
                            },
                            {
                                "name": "node.master",
                                "value": "true"
                            }
                        ],
                        "image": "docker.elastic.co/elasticsearch/elasticsearch:7.8.0",
                        "imagePullPolicy": "IfNotPresent",
                        "name": "elasticsearch",
                        "ports": [
                            {
                                "containerPort": 9200,
                                "name": "http",
                                "protocol": "TCP"
                            },
                            {
                                "containerPort": 9300,
                                "name": "transport",
                                "protocol": "TCP"
                            }
                        ],
                        "readinessProbe": {
                            "exec": {
                                "command": [
                                    "sh",
                                    "-c",
                                    "#!/usr/bin/env bash -e\n# If the node is starting up wait for the cluster to be ready (request params: \"wait_for_status=green\u0026timeout=1s\" )\n# Once it has started only check that the node itself is responding\nSTART_FILE=/tmp/.es_start_file\n\nhttp () {\n  local path=\"${1}\"\n  local args=\"${2}\"\n  set -- -XGET -s\n\n  if [ \"$args\" != \"\" ]; then\n    set -- \"$@\" $args\n  fi\n\n  if [ -n \"${ELASTIC_USERNAME}\" ] \u0026\u0026 [ -n \"${ELASTIC_PASSWORD}\" ]; then\n    set -- \"$@\" -u \"${ELASTIC_USERNAME}:${ELASTIC_PASSWORD}\"\n  fi\n\n  curl --output /dev/null -k \"$@\" \"http://127.0.0.1:9200${path}\"\n}\n\nif [ -f \"${START_FILE}\" ]; then\n  echo 'Elasticsearch is already running, lets check the node is healthy'\n  HTTP_CODE=$(http \"/\" \"-w %{http_code}\")\n  RC=$?\n  if [[ ${RC} -ne 0 ]]; then\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} http://127.0.0.1:9200/ failed with RC ${RC}\"\n    exit ${RC}\n  fi\n  # ready if HTTP code 200, 503 is tolerable if ES version is 6.x\n  if [[ ${HTTP_CODE} == \"200\" ]]; then\n    exit 0\n  elif [[ ${HTTP_CODE} == \"503\" \u0026\u0026 \"7\" == \"6\" ]]; then\n    exit 0\n  else\n    echo \"curl --output /dev/null -k -XGET -s -w '%{http_code}' \\${BASIC_AUTH} http://127.0.0.1:9200/ failed with HTTP code ${HTTP_CODE}\"\n    exit 1\n  fi\n\nelse\n  echo 'Waiting for elasticsearch cluster to become ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n  if http \"/_cluster/health?wait_for_status=green\u0026timeout=1s\" \"--fail\" ; then\n    touch ${START_FILE}\n    exit 0\n  else\n    echo 'Cluster is not yet ready (request params: \"wait_for_status=green\u0026timeout=1s\" )'\n    exit 1\n  fi\nfi\n"
                                ]
                            },
                            "failureThreshold": 3,
                            "initialDelaySeconds": 10,
                            "periodSeconds": 10,
                            "successThreshold": 3,
                            "timeoutSeconds": 5
                        },
                        "resources": {
                            "limits": {
                                "cpu": "1",
                                "memory": "2Gi"
                            },
                            "requests": {
                                "cpu": "1",
                                "memory": "2Gi"
                            }
                        },
                        "securityContext": {
                            "capabilities": {
                                "drop": [
                                    "ALL"
                                ]
                            },
                            "runAsNonRoot": true,
                            "runAsUser": 1000
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File",
                        "volumeMounts": [
                            {
                                "mountPath": "/usr/share/elasticsearch/data",
                                "name": "elasticsearch-master"
                            }
                        ]
                    }
                ],
                "dnsPolicy": "ClusterFirst",
                "enableServiceLinks": true,
                "initContainers": [
                    {
                        "command": [
                            "sysctl",
                            "-w",
                            "vm.max_map_count=262144"
                        ],
                        "image": "docker.elastic.co/elasticsearch/elasticsearch:7.8.0",
                        "imagePullPolicy": "IfNotPresent",
                        "name": "configure-sysctl",
                        "resources": {},
                        "securityContext": {
                            "privileged": true,
                            "runAsUser": 0
                        },
                        "terminationMessagePath": "/dev/termination-log",
                        "terminationMessagePolicy": "File"
                    }
                ],
                "restartPolicy": "Always",
                "schedulerName": "default-scheduler",
                "securityContext": {
                    "fsGroup": 1000,
                    "runAsUser": 1000
                },
                "terminationGracePeriodSeconds": 120
            }
        },
        "updateStrategy": {
            "type": "RollingUpdate"
        },
        "volumeClaimTemplates": [
            {
                "apiVersion": "v1",
                "kind": "PersistentVolumeClaim",
                "metadata": {
                    "creationTimestamp": null,
                    "name": "elasticsearch-master"
                },
                "spec": {
                    "accessModes": [
                        "ReadWriteOnce"
                    ],
                    "resources": {
                        "requests": {
                            "storage": "2Gi"
                        }
                    },
                    "volumeMode": "Filesystem",
"storageClassName": "local-storage0"
                },
                "status": {
                    "phase": "Pending"
                }
            }
        ]
    },
    "status": {
        "collisionCount": 0,
        "currentReplicas": 3,
        "currentRevision": "elasticsearch-master-765485fbdd",
        "observedGeneration": 1,
        "replicas": 2,
        "updateRevision": "elasticsearch-master-765485fbdd",
        "updatedReplicas": 3
    }
}
